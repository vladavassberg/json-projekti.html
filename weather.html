<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON-datan käsittelyä</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">

</head>
<body class="d-flex flex-column min-vh-100">
    <nav class="navbar navbar-expand-lg navbar-custom">
  <div class="container-fluid">
  
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="index.html">Etusivu</a></li>
        <li class="nav-item"><a class="nav-link" href="toteutus.html">Digipalvelut</a></li>
        <li class="nav-item"><a class="nav-link" href="pokehaku.html">Pokemon haku</a></li>
        <li class="nav-item"><a class="nav-link" href="weather.html">Säätiedot</a></li>
      </ul>
    </div>
  </div>
</nav>

<main class="container my-5">
  <div id="weather-tiedot">Ladataan säätietoja</div>
  </div>
</main>

<footer class="mt-auto">
  <p class="text-center">Säätiedot</p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
  const URL = "https://api.open-meteo.com/v1/forecast?latitude=60.17&longitude=24.94&current_weather=true";

  // haetaan säätiedot
  fetch(URL)
    .then(function(response) {
      return response.json();
    })

    .then(function(responseJson) {
      naytaSaa(responseJson);
    })

    .catch(function(error) {
      document.getElementById("weather-tiedot").innerHTML = "<p>Virhe: säätietoja ei voitu hakea.</p>";
    });

  function naytaSaa(data) {
    const weather = data.current_weather;
    const lampotila = weather.temperature;
    const tuuli = weather.windspeed;
    const aikaUTC = weather.time;
    const weatherCode = weather.weathercode;

    // muutetaan aika Suomen paikallisaikaan
    const aikaLocal = new Date(aikaUTC + "Z").toLocaleString("fi-FI", {
      timeZone: "Europe/Helsinki",
      weekday: "long",
      year: "numeric",
      month: "long",
      day: "numeric",
      hour: "2-digit",
      minute: "2-digit",
      hour12: false
    });

    // säätunnuskuvat
    const weatherIcons = {
      0:  { teksti: "Selkeä taivas", kuva: "https://openweathermap.org/img/wn/01d.png" },
      1:  { teksti: "Melkein selkeää", kuva: "https://openweathermap.org/img/wn/02d.png" },
      2:  { teksti: "Puolipilvistä", kuva: "https://openweathermap.org/img/wn/03d.png" },
      3:  { teksti: "Pilvistä", kuva: "https://openweathermap.org/img/wn/04d.png" },
      45: { teksti: "Sumu", kuva: "https://openweathermap.org/img/wn/50d.png" },
      48: { teksti: "Jäähileinen sumu", kuva: "https://openweathermap.org/img/wn/50d.png" },
      51: { teksti: "Kevyttä tihkua", kuva: "https://openweathermap.org/img/wn/09d.png" },
      53: { teksti: "Kohtalaista tihkua", kuva: "https://openweathermap.org/img/wn/09d.png" },
      55: { teksti: "Tiheää tihkua", kuva: "https://openweathermap.org/img/wn/09d.png" },
      56: { teksti: "Kevyttä jäätävää tihkua", kuva: "https://openweathermap.org/img/wn/13d.png" },
      57: { teksti: "Tiheää jäätävää tihkua", kuva: "https://openweathermap.org/img/wn/13d.png" },
      61: { teksti: "Kevyttä sadetta", kuva: "https://openweathermap.org/img/wn/10d.png" },
      63: { teksti: "Kohtalaista sadetta", kuva: "https://openweathermap.org/img/wn/10d.png" },
      65: { teksti: "Rankkaa sadetta", kuva: "https://openweathermap.org/img/wn/10d.png" },
      66: { teksti: "Kevyttä jäätävää sadetta", kuva: "https://openweathermap.org/img/wn/13d.png" },
      67: { teksti: "Tiheää jäätävää sadetta", kuva: "https://openweathermap.org/img/wn/13d.png" },
      71: { teksti: "Kevyttä lumisadetta", kuva: "https://openweathermap.org/img/wn/13d.png" },
      73: { teksti: "Kohtalaista lumisadetta", kuva: "https://openweathermap.org/img/wn/13d.png" },
      75: { teksti: "Rankkaa lumisadetta", kuva: "https://openweathermap.org/img/wn/13d.png" },
      77: { teksti: "Lumirakeita", kuva: "https://openweathermap.org/img/wn/13d.png" },
      80: { teksti: "Kevyitä sadekuuroja", kuva: "https://openweathermap.org/img/wn/09d.png" },
      81: { teksti: "Kohtalaisia sadekuuroja", kuva: "https://openweathermap.org/img/wn/09d.png" },
      82: { teksti: "Rankkoja sadekuuroja", kuva: "https://openweathermap.org/img/wn/09d.png" },
      85: { teksti: "Kevyitä lumikuuroja", kuva: "https://openweathermap.org/img/wn/13d.png" },
      86: { teksti: "Rankkoja lumikuuroja", kuva: "https://openweathermap.org/img/wn/13d.png" },
      95: { teksti: "Ukkosta", kuva: "https://openweathermap.org/img/wn/11d.png" },
      96: { teksti: "Ukkosta ja rakeita", kuva: "https://openweathermap.org/img/wn/11d.png" },
      99: { teksti: "Voimakasta ukkosta ja rakeita", kuva: "https://openweathermap.org/img/wn/11d.png" }
};
    const weatherInfo = weatherIcons[weatherCode] || { teksti: "Tuntematon sää", kuva: "https://openweathermap.org/img/wn/01d.png" };

    // html näkymä
    const content = `
      <div id="weather-container">
        <h3>Nykyinen sää Helsingissä</h3>
        <p><b>Sää:</b> ${weatherInfo.teksti}</p>
        <p><b>Lämpötila:</b> ${lampotila} °C</p>
        <p><b>Tuuli:</b> ${tuuli} m/s</p>
        <img src="${weatherInfo.kuva}" alt="${weatherInfo.teksti}" style="max-width:100px; border-radius:10px;">
        <p><small>Sää Helsingissä  ${aikaLocal}</small></p>
      </div>
    `;

    document.getElementById("weather-tiedot").innerHTML = content;
  }
</script>
</body>
</html>